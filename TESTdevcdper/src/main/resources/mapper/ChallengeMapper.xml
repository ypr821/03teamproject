<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  
<!-- Challenge 관련 Mapper -->
<mapper namespace="com.devcdper.challenge.dao.ChallengeMapper">
	<resultMap type="com.devcdper.challenge.domain.Challenge" id="ChallengeResultMap">
		<result property="challengeCode"					column="challenge_code"/>
		<result property="challengeCategoryCode"			column="challenge_category_code"/>
		<result property="challengeOpenerEmail"				column="challenge_opener_email"/>
		<result property="challengeName"					column="challenge_name"/>
		<result property="challengeScope"					column="challenge_scope"/>
		<result property="challengeParticipationPassword"	column="challenge_participation_password"/>
		<result property="challengeTag"						column="challenge_tag"/>
		<result property="challengeIntroduce"				column="challenge_introduce"/>
		<result property="challengeMaximumPeople"			column="challenge_maximum_people"/>
		<result property="challengeBetAmount"				column="challenge_bet_amount"/>
		<result property="challengeCertificationMethod"		column="challenge_certification_method"/>
		<result property="challengeCertificationContents"	column="challenge_certification_contents"/>
		<result property="challengeCertificationFrequency"	column="challenge_certification_frequency"/>
		<result property="challengeProgressStatus"			column="challenge_progress_status"/>
		<result property="challengeStartDate"				column="challenge_start_date"/>
		<result property="challengeEndDate"					column="challenge_end_date"/>
		<result property="challengeRegisterDate"			column="challenge_register_date"/>
		<association property="normalUser" javaType="com.devcdper.user_admin.domain.NormalUser">
			<result property="userEmail" 				column="user_email"/>
			<result property="userPassword" 			column="user_password"/>
			<result property="userName" 				column="user_name"/>
			<result property="userBirth" 				column="user_birth"/>
			<result property="userAddr" 				column="user_addr"/>
			<result property="userAddrDetail" 			column="user_addr_detail"/>
			<result property="userGender" 				column="user_gender"/>
			<result property="userMoblie" 				column="user_mobile"/>
			<result property="userJob" 		 			column="user_job"/>
			<result property="userIsReceiveMarketing" 	column="user_is_receive_marketing"/>
			<result property="userJoinMotivation" 		column="user_join_motivation"/>
			<result property="userJoinPath" 		 	column="user_join_path"/>
			<result property="userRecommendEmail" 		column="user_recommend_email"/>
			<result property="userJoinDate" 			column="user_join_date"/>
			<result property="userWithdrawStatus" 		column="user_withdraw_status"/>
		</association>
		<association property="challengeCategory" javaType="com.devcdper.challenge.domain.ChallengeCategory">
			<result property="challengeCategoryCode" 		column="challenge_category_code"></result>
			<result property="challengeCategoryName" 	column="challenge_category_name"></result>
		</association>
	</resultMap>
	
		<select id="getChallengeInsertOpenerEmail" parameterType="String" resultType="String">
			SELECT 
				challenge_opener_email
			FROM 
				challenge
			Where
				challenge_opener_email = #{sessionEmail}
			GROUP BY challenge_opener_email
		</select>
	
		<!-- 챌린지 개설하기 (등록) -->
		<insert id="addChallenge" parameterType="com.devcdper.challenge.domain.Challenge">
		INSERT INTO challenge
		(			challenge_code
				  , challenge_category_code
				  , challenge_opener_email
				  , challenge_name
				  , challenge_scope
				  , challenge_participation_password
				  , challenge_tag
				  , challenge_introduce
				  , challenge_maximum_people
				  , challenge_bet_amount
				  , challenge_certification_method
				  , challenge_certification_contents
				  , challenge_certification_frequency
				  , challenge_progress_status
				  , challenge_start_date
				  , challenge_end_date
				  , challenge_register_date
		) VALUES (
				sf_newChallengeCode()
				, #{challengeCategoryCode}
				, #{challengeOpenerEmail}
				, #{challengeName}
				, #{challengeScope}
				, #{challengeParticipationPassword}
				, #{challengeTag}
				, #{challengeIntroduce}
				, #{challengeMaximumPeople}
				, #{challengeBetAmount}
				, #{challengeCertificationMethod}
				, #{challengeCertificationContents}
				, #{challengeCertificationFrequency}
				, #{challengeProgressStatus}
				, #{challengeStartDate}
				, #{challengeEndDate}
				, CURDATE());
		</insert>
	
	
	<!-- 메인 챌린지 & 챌린지 탐색하기 : 전체 리스트 조회 -->
	<select id="getChallengeExplorationList" resultMap="ChallengeResultMap">
				SELECT
					challenge_code,
					challenge_name,
					challenge_tag	
				FROM 
						challenge;
	</select>
	
	<!-- 메인 챌린지 & 챌린지 탐색하기 : 카테고리별 리스트 조회 -->
	<select id="getChallengeByCategoryExplorationList" parameterType="String" resultType="com.devcdper.challenge.domain.Challenge">
			SELECT 
						c.challenge_code AS challengeCode,
						cc.challenge_category_code AS challengeCategoryCode,
						cc.challenge_category_name AS categoryBtnName,
						c.challenge_name AS challengeName,
						c.challenge_tag AS challengeTag
				FROM 
						challenge_category AS cc
				INNER JOIN
						challenge AS c
				on
				cc.challenge_category_code = c.challenge_category_code
			WHERE
				cc.challenge_category_code = #{challengeCategoryCode};
	</select>
	
	
	
	<!-- 챌린지 탐색하기 : 상세정보 조회 -->
	<!-- 챌린지 참여하기 : 상세정보 조회 -->
	<select id="getChallengeExplorationDetailInfoByChallengeCode" parameterType="String" resultMap="ChallengeResultMap">
				SELECT 
					c.challenge_code,
					c.challenge_name, 
					c.challenge_introduce, 
					c.challenge_maximum_people, 
					c.challenge_bet_amount, 
					c.challenge_certification_method, 
					c.challenge_certification_contents,
					c.challenge_certification_frequency, 
					c.challenge_start_date, 
					c.challenge_end_date
				FROM 
					challenge AS c
				WHERE
					c.challenge_code = #{challengeCode};
	</select>
	
	
	
	<!-- 관리자 페이지 : 개설 챌린지 전체 행 개수 조회 -->
	<select id="getChallengeCount" resultType="int">
			SELECT
				COUNT(1)
				FROM 
						challenge AS c
				INNER JOIN
						user AS u
				on
					c.challenge_opener_email = u.user_email
				INNER JOIN
						challenge_category AS cc
				on
					c.challenge_category_code = cc.challenge_category_code
	</select>
	
	<!-- 관리자 페이지 : 개설 챌린지 전체 조회 -->
	<select id="getChallengeList" resultMap="ChallengeResultMap" parameterType="Map">
				SELECT
					c.challenge_name, 
					cc.challenge_category_name,
					u.user_email,
					c.challenge_scope,
					c.challenge_participation_password,
					c.challenge_maximum_people,
					c.challenge_bet_amount,
					c.challenge_certification_method,
					c.challenge_certification_contents,
					c.challenge_certification_frequency,
					c.challenge_start_date, 
					c.challenge_end_date, 
					c.challenge_register_date,
					c.challenge_progress_status
				FROM 
						challenge AS c
				INNER JOIN
						user AS u
				on
					c.challenge_opener_email = u.user_email
				INNER JOIN
						challenge_category AS cc
				on
					c.challenge_category_code = cc.challenge_category_code
				LIMIT #{rowStart}, #{rowPerPage};
	</select>
	
	
	<!-- 나의 챌린지 : 개설 챌린지 전체 리스트 행 개수 -->
	<select id="getMyChallengeInsertCount" resultType="int">
		SELECT 
					count(1)
				FROM 
						challenge AS c		
				INNER JOIN
						challenge_category AS cc
				on
					c.challenge_category_code = cc.challenge_category_code
				<trim prefix="WHERE" prefixOverrides="AND |OR ">
				<if test="categorySearchOption != null and categorySearchOption != ''.toString()">
						<if test="categorySearchOption == 'all'.toString()">
								and cc.challenge_category_name = '학력'
								and cc.challenge_category_name = '프로젝트'
								and cc.challenge_category_name = '자격증'
								and cc.challenge_category_name = '공인어학(외국어능력)'
								and cc.challenge_category_name = '기술스택'
								and cc.challenge_category_name = '직종전문교육과정'
								and cc.challenge_category_name = '인턴십'
								and cc.challenge_category_name = '공모전'
								and cc.challenge_category_name = '경력'
						</if>
						<if test="categorySearchOption == '학력'.toString()">
								or cc.challenge_category_name = '학력'
						</if>
						<if test="categorySearchOption == '프로젝트'.toString()">
								and cc.challenge_category_name = '프로젝트'
						</if>
						<if test="categorySearchOption == '자격증'.toString()">
								and cc.challenge_category_name = '자격증'
						</if>
						<if test="categorySearchOption == '공인어학(외국어능력)'.toString()">
								and cc.challenge_category_name = '공인어학(외국어능력)'
						</if>
						<if test="categorySearchOption == '기술스택'.toString()">
								and cc.challenge_category_name = '기술스택'
						</if>
						<if test="categorySearchOption == '직종전문교육과정'.toString()">
								and cc.challenge_category_name = '직종전문교육과정'
						</if>
						<if test="categorySearchOption == '인턴십'.toString()">
								and cc.challenge_category_name = '인턴십'
						</if>
						<if test="categorySearchOption == '공모전'.toString()">
								and cc.challenge_category_name = '공모전'
						</if>
						<if test="categorySearchOption == '경력'.toString()">
								and cc.challenge_category_name = '경력'
						</if>
				</if>
				<if test="myChallengeSearchKey != null and myChallengeSearchKey != ''.toString()">
						<if test="categorySearchOption == 'all'.toString() and myChallengeSearchKey == 'all'.toString()">
								or (c.challenge_name LIKE CONCAT('%', #{myChallengeSearchValue} ,'%')
									and c.challenge_certification_contents LIKE CONCAT('%', #{myChallengeSearchValue} ,'%')
									and c.challenge_tag LIKE CONCAT('%', #{myChallengeSearchValue} ,'%'))
						</if>
						<if test="myChallengeSearchKey == 'all'.toString()">
								and (c.challenge_name LIKE CONCAT('%', #{myChallengeSearchValue} ,'%')
									and c.challenge_certification_contents LIKE CONCAT('%', #{myChallengeSearchValue} ,'%')
									and c.challenge_tag LIKE CONCAT('%', #{myChallengeSearchValue} ,'%'))
						</if>
						<if test="myChallengeSearchKey == 'challengeName'.toString()">
								or c.challenge_name LIKE CONCAT('%', #{myChallengeSearchValue} ,'%')
						</if>
						<if test="myChallengeSearchKey == 'challengeCertificationContents'.toString()">
								or c.challenge_certification_contents LIKE CONCAT('%', #{myChallengeSearchValue} ,'%')
						</if>
						<if test="myChallengeSearchKey == 'challengeTag'.toString()">
								or c.challenge_tag LIKE CONCAT('%', #{myChallengeSearchValue} ,'%')
						</if>
						<if test="myChallengeSearchKey == 'cNcCC'.toString()">
								and (c.challenge_name LIKE CONCAT('%', #{myChallengeSearchValue} ,'%')
									or c.challenge_certification_contents LIKE CONCAT('%', #{myChallengeSearchValue} ,'%'))
						</if>
				</if>
				<if test="termSearchOption != null and termSearchOption != ''.toString()">
						<if test="termSearchOption == '1week'.toString()">
								and challenge_start_date BETWEEN DATE_ADD(NOW(),INTERVAL -1 WEEK ) AND NOW()
						</if>
						<if test="termSearchOption == '2week'.toString()">
								and challenge_start_date BETWEEN DATE_ADD(NOW(),INTERVAL -2 WEEK ) AND NOW()
						</if>
						<if test="termSearchOption == '3week'.toString()">
								and challenge_start_date BETWEEN DATE_ADD(NOW(),INTERVAL -3 WEEK ) AND NOW()
						</if>
						<if test="termSearchOption == '1month'.toString()">
								and challenge_start_date BETWEEN DATE_ADD(NOW(),INTERVAL -1 MONTH ) AND NOW()
						</if>
						<if test="termSearchOption == '2month'.toString()">
								and challenge_start_date BETWEEN DATE_ADD(NOW(),INTERVAL -2 MONTH ) AND NOW();
						</if>
						<if test="termSearchOption == '3month'.toString()">
								and challenge_start_date BETWEEN DATE_ADD(NOW(),INTERVAL -3 MONTH ) AND NOW();
						</if>
						<if test="termSearchOption == '6month'.toString()">
								and challenge_start_date BETWEEN DATE_ADD(NOW(),INTERVAL -6 MONTH ) AND NOW();
						</if>
				</if>
			</trim>
			and c.challenge_opener_email = #{sessionEmail}
			<if test="sortOption != null and sortOption != ''.toString() and sortOption != 'all'.toString()">
			Order by
					<choose>  
          				<when test="sortOption == 'endDate_asc'.toString()">
            			   		c.challenge_end_date ASC
		          		</when>         
		          	 	<when test="sortOption == 'endDate_desc'.toString()">
		              		 	c.challenge_end_date DESC
		         	    </when> 
		          	 	<when test="sortOption == 'startDate_asc'.toString()">
		              		 	c.challenge_start_date ASC
		         	    </when> 
		          	 	<when test="sortOption == 'startDate_desc'.toString()">
		              		 	c.challenge_start_date DESC
		         	    </when> 
		          	 	<when test="sortOption == 'challengeName_desc'.toString()">
		              		 	c.challenge_name DESC
		         	    </when> 
		          	 	<when test="sortOption == 'challengeName_asc'.toString()">
		              		 	c.challenge_name ASC
		         	    </when> 
					</choose>			
			</if>
			<if test="startDateSearchOption != null and startDateSearchOption != ''.toString()">
							between #{startDateSearchOption} and #{endDateSearchOption}
			</if>
	</select>
	
	<!-- 나의 챌린지 : 개설 챌린지 상세정보 조회 -->
	<select id="getMyChallengeInsertDetailInfoByChallengeCode" parameterType="String" resultMap="ChallengeResultMap">
				SELECT 
					c.challenge_code,
					c.challenge_name, 
					c.challenge_introduce, 
					c.challenge_maximum_people, 
					c.challenge_bet_amount,
					c.challenge_introduce, 
					c.challenge_certification_method, 
					c.challenge_certification_contents,
					c.challenge_certification_frequency,
					c.challenge_start_date, 
					c.challenge_end_date
				FROM 
						challenge AS c		
				where
					c.challenge_opener_email = #{sessionEmail}
					AND
					c.challenge_code=#{challengeCode}
		</select>
	
	<!-- 나의 챌린지 : 개설 챌린지 전체 리스트 조회 -->
	<select id="getMyChallengeInsertList" parameterType="map" resultMap="ChallengeResultMap">
				SELECT 
					c.challenge_code,
					c.challenge_name, 
					cc.challenge_category_name,
					c.challenge_scope,
					c.challenge_tag,
					c.challenge_maximum_people,
					c.challenge_certification_frequency,
					c.challenge_bet_amount,
					c.challenge_start_date, 
					c.challenge_end_date
				FROM 
						challenge AS c		
				INNER JOIN
						challenge_category AS cc
				on
					c.challenge_category_code = cc.challenge_category_code
				<trim prefix="WHERE" prefixOverrides="AND |OR ">
				<if test="categorySearchOption != null and categorySearchOption != ''.toString()">
						<if test="categorySearchOption == 'all'.toString()">
								and cc.challenge_category_name = '학력'
								and cc.challenge_category_name = '프로젝트'
								and cc.challenge_category_name = '자격증'
								and cc.challenge_category_name = '공인어학(외국어능력)'
								and cc.challenge_category_name = '기술스택'
								and cc.challenge_category_name = '직종전문교육과정'
								and cc.challenge_category_name = '인턴십'
								and cc.challenge_category_name = '공모전'
								and cc.challenge_category_name = '경력'
						</if>
						<if test="categorySearchOption == '학력'.toString()">
								or cc.challenge_category_name = '학력'
						</if>
						<if test="categorySearchOption == '프로젝트'.toString()">
								and cc.challenge_category_name = '프로젝트'
						</if>
						<if test="categorySearchOption == '자격증'.toString()">
								and cc.challenge_category_name = '자격증'
						</if>
						<if test="categorySearchOption == '공인어학(외국어능력)'.toString()">
								and cc.challenge_category_name = '공인어학(외국어능력)'
						</if>
						<if test="categorySearchOption == '기술스택'.toString()">
								and cc.challenge_category_name = '기술스택'
						</if>
						<if test="categorySearchOption == '직종전문교육과정'.toString()">
								and cc.challenge_category_name = '직종전문교육과정'
						</if>
						<if test="categorySearchOption == '인턴십'.toString()">
								and cc.challenge_category_name = '인턴십'
						</if>
						<if test="categorySearchOption == '공모전'.toString()">
								and cc.challenge_category_name = '공모전'
						</if>
						<if test="categorySearchOption == '경력'.toString()">
								and cc.challenge_category_name = '경력'
						</if>
				</if>
				<if test="myChallengeSearchKey != null and myChallengeSearchKey != ''.toString()">
						<if test="categorySearchOption == 'all'.toString() and myChallengeSearchKey == 'all'.toString()">
								or (c.challenge_name LIKE CONCAT('%', #{myChallengeSearchValue} ,'%')
									and c.challenge_certification_contents LIKE CONCAT('%', #{myChallengeSearchValue} ,'%')
									and c.challenge_tag LIKE CONCAT('%', #{myChallengeSearchValue} ,'%'))
						</if>
						<if test="myChallengeSearchKey == 'all'.toString()">
								and (c.challenge_name LIKE CONCAT('%', #{myChallengeSearchValue} ,'%')
									and c.challenge_certification_contents LIKE CONCAT('%', #{myChallengeSearchValue} ,'%')
									and c.challenge_tag LIKE CONCAT('%', #{myChallengeSearchValue} ,'%'))
						</if>
						<if test="myChallengeSearchKey == 'challengeName'.toString()">
								or c.challenge_name LIKE CONCAT('%', #{myChallengeSearchValue} ,'%')
						</if>
						<if test="myChallengeSearchKey == 'challengeCertificationContents'.toString()">
								or c.challenge_certification_contents LIKE CONCAT('%', #{myChallengeSearchValue} ,'%')
						</if>
						<if test="myChallengeSearchKey == 'challengeTag'.toString()">
								or c.challenge_tag LIKE CONCAT('%', #{myChallengeSearchValue} ,'%')
						</if>
						<if test="myChallengeSearchKey == 'cNcCC'.toString()">
								and (c.challenge_name LIKE CONCAT('%', #{myChallengeSearchValue} ,'%')
									or c.challenge_certification_contents LIKE CONCAT('%', #{myChallengeSearchValue} ,'%'))
						</if>
				</if>
				<if test="termSearchOption != null and termSearchOption != ''.toString()">
						<if test="termSearchOption == '1week'.toString()">
								and challenge_start_date BETWEEN DATE_ADD(NOW(),INTERVAL -1 WEEK ) AND NOW()
						</if>
						<if test="termSearchOption == '2week'.toString()">
								and challenge_start_date BETWEEN DATE_ADD(NOW(),INTERVAL -2 WEEK ) AND NOW()
						</if>
						<if test="termSearchOption == '3week'.toString()">
								and challenge_start_date BETWEEN DATE_ADD(NOW(),INTERVAL -3 WEEK ) AND NOW()
						</if>
						<if test="termSearchOption == '1month'.toString()">
								and challenge_start_date BETWEEN DATE_ADD(NOW(),INTERVAL -1 MONTH ) AND NOW()
						</if>
						<if test="termSearchOption == '2month'.toString()">
								and challenge_start_date BETWEEN DATE_ADD(NOW(),INTERVAL -2 MONTH ) AND NOW();
						</if>
						<if test="termSearchOption == '3month'.toString()">
								and challenge_start_date BETWEEN DATE_ADD(NOW(),INTERVAL -3 MONTH ) AND NOW();
						</if>
						<if test="termSearchOption == '6month'.toString()">
								and challenge_start_date BETWEEN DATE_ADD(NOW(),INTERVAL -6 MONTH ) AND NOW();
						</if>
				</if>
				
			</trim>
			and c.challenge_opener_email = #{sessionEmail}
			<if test="sortOption != null and sortOption != ''.toString() and sortOption != 'all'.toString()">
			Order by
					<choose>  
          				<when test="sortOption == 'endDate_asc'.toString()">
            			   		c.challenge_end_date ASC
		          		</when>         
		          	 	<when test="sortOption == 'endDate_desc'.toString()">
		              		 	c.challenge_end_date DESC
		         	    </when> 
		          	 	<when test="sortOption == 'startDate_asc'.toString()">
		              		 	c.challenge_start_date ASC
		         	    </when> 
		          	 	<when test="sortOption == 'startDate_desc'.toString()">
		              		 	c.challenge_start_date DESC
		         	    </when> 
		          	 	<when test="sortOption == 'challengeName_desc'.toString()">
		              		 	c.challenge_name DESC
		         	    </when> 
		          	 	<when test="sortOption == 'challengeName_asc'.toString()">
		              		 	c.challenge_name ASC
		         	    </when> 
					</choose>			
			</if>
			LIMIT #{rowStart}, #{rowPerPage}
			<if test="startDateSearchOption != null and startDateSearchOption != ''.toString()">
							between #{startDateSearchOption} and #{endDateSearchOption}
			</if>
		</select>
	
	
	<!-- 나의 챌린지 : 개설 챌린지 설정(수정) -->
	<!-- 나의 챌린지 : 수정할 챌린지 속성 리스트 조회 -->
	<select id="getModifyInsertChallengeAttributeList" parameterType="String" resultMap="ChallengeResultMap">
			SELECT
				challenge_code,
				challenge_opener_email,
				challenge_name,
				challenge_start_date,
				challenge_end_date,
				challenge_certification_method,
				challenge_introduce,
				challenge_tag
			FROM
				challenge
			WHERE 
				challenge_code=#{challengeCode}
			and
				challenge_opener_email=#{sessionEmail};
	</select>
	
	<!-- 1. 나의 챌린지 : 챌린지명 수정 -->
	<update id="modifyChallengeName" parameterType="com.devcdper.challenge.domain.Challenge">
		UPDATE challenge
		<trim prefix="SET" prefixOverrides=",">
			<if test="challengeName != null and challengeName != ''.toString()">
				challenge_name=#{challengeName}
			</if>
		</trim>	
		WHERE 
				challenge_code=#{challengeCode};
	</update>
	
	<!-- 2. 나의 챌린지 : 챌린지 기간(날짜) 수정-->
	<update id="modifyChallengePeriod" parameterType="com.devcdper.challenge.domain.Challenge">
			UPDATE challenge
			<trim prefix="SET" prefixOverrides=",">
				<if test="challengeStartDate != null and challengeStartDate != ''.toString()">
					challenge_start_date=#{challengeStartDate}
				</if>
				<if test="challengeEndDate != null and challengeEndDate != ''.toString()">
					,challenge_end_date=#{challengeEndDate}
				</if>
			</trim>
			WHERE 
				challenge_code=#{challengeCode};
	</update> 
	
	<!-- 3. 나의 챌린지 : 챌린지 인증방법 수정 -->
	<update id="modifyChallengeCertificationMethod" parameterType="com.devcdper.challenge.domain.Challenge">
		UPDATE challenge
		<trim prefix="SET" prefixOverrides=",">
			<if test="challengeCertificationMethod != null and challengeCertificationMethod != ''.toString()">
				challenge_certification_method= #{challengeCertificationMethod}
			</if>
		</trim>
		WHERE 
			challenge_code=#{challengeCode};
	</update>
	
	<!-- 4. 나의 챌린지 : 챌린지 소개 수정-->
	<update id="modifyChallengeIntroduce" parameterType="com.devcdper.challenge.domain.Challenge">
		UPDATE challenge
		<trim prefix="SET" prefixOverrides=",">
			<if test="challengeIntroduce != null and challengeIntroduce != ''.toString()">
				challenge_introduce= #{challengeIntroduce}
			</if>
		</trim>
		WHERE 
			challenge_code=#{challengeCode};
	</update>

	<!-- 5. 나의 챌린지 : 챌린지 태그 수정-->
	<update id="modifyChallengeTag" parameterType="com.devcdper.challenge.domain.Challenge">
		UPDATE challenge
		<trim prefix="SET" prefixOverrides=",">
			<if test="challengeTag != null and challengeTag != ''.toString()">
				challenge_tag=#{challengeTag}
			</if>
		</trim>
		WHERE 
			challenge_code=#{challengeCode};
	</update>
	
	
	<delete id="removeChallengeByEmailAndCode" parameterType="String">
			DELETE 
			FROM 
				challenge 
			WHERE 
				challenge_code=#{challengeCode}
			AND
				challenge_opener_email=#{sessionEmail}
	</delete>
	
	
	
	
	
	<!-- User 관련 Mapper -->
	<!-- ChallengeParticipation 관련 -->
	<resultMap type="com.devcdper.challenge.domain.ChallengeParticipation" id="ChallengeParticipationResultMap">
		<result property="challengeParticipationCode"			column="challenge_participation_code"/>
		<result property="challengeCategoryCode"			column="challenge_category_code"/>
		<result property="challengeCode"					column="challenge_code"/>
		<result property="challengeParticipationEmail"		column="challenge_participation_email"/>
		<result property="challengeScope"					column="plan_detail_code"/>
		<result property="allPaymentConnectGroupCode"		column="all_payment_connect_group_code"/>
		<result property="challengeParticipationDate"		column="challenge_participation_date"/>
		<result property="challengeParticipationProgressStatus"		column="challenge_participation_progress_status"/>
		<result property="challengeServiceStartDate"		column="challenge_service_start_date"/>
		<result property="challengeServiceEndDate"			column="challenge_service_end_date"/>
		<association property="normalUser" javaType="com.devcdper.user_admin.domain.NormalUser">
			<result property="userEmail" 				column="user_email"/>
			<result property="userPassword" 			column="user_password"/>
			<result property="userName" 				column="user_name"/>
			<result property="userBirth" 				column="user_birth"/>
			<result property="userAddr" 				column="user_addr"/>
			<result property="userAddrDetail" 			column="user_addr_detail"/>
			<result property="userGender" 				column="user_gender"/>
			<result property="userMoblie" 				column="user_mobile"/>
			<result property="userJob" 		 			column="user_job"/>
			<result property="userIsReceiveMarketing" 	column="user_is_receive_marketing"/>
			<result property="userJoinMotivation" 		column="user_join_motivation"/>
			<result property="userJoinPath" 		 	column="user_join_path"/>
			<result property="userRecommendEmail" 		column="user_recommend_email"/>
			<result property="userJoinDate" 			column="user_join_date"/>
			<result property="userWithdrawStatus" 		column="user_withdraw_status"/>
		</association>
		<association property="challengeCategory" javaType="com.devcdper.challenge.domain.ChallengeCategory">
			<result property="challengeCategoryCode" 		column="challenge_category_code"></result>
			<result property="challengeCategoryName" 	column="challenge_category_name"></result>
		</association>
		<association property="challenge" javaType="com.devcdper.challenge.domain.Challenge">
			<result property="challengeCode"					column="challenge_code"/>
			<result property="challengeCategoryCode"			column="challenge_category_code"/>
			<result property="challengeOpenerEmail"				column="challenge_opener_email"/>
			<result property="challengeName"					column="challenge_name"/>
			<result property="challengeScope"					column="challenge_scope"/>
			<result property="challengeParticipationPassword"	column="challenge_participation_password"/>
			<result property="challengeTag"						column="challenge_tag"/>
			<result property="challengeMaximumPeople"			column="challenge_maximum_people"/>
			<result property="challengeBetAmount"				column="challenge_bet_amount"/>
			<result property="challengeIntroduce"				column="challenge_introduce"/>
			<result property="challengeCertificationMethod"		column="challenge_certification_method"/>
			<result property="challengeCertificationContents"	column="challenge_certification_contents"/>
			<result property="challengeCertificationFrequency"	column="challenge_certification_frequency"/>
			<result property="challengeProgressStatus"			column="challenge_progress_status"/>
			<result property="challengeStartDate"				column="challenge_start_date"/>
			<result property="challengeEndDate"					column="challenge_end_date"/>
			<result property="challengeRegisterDate"			column="challenge_register_date"/>
		</association>
		<association property="payment" javaType="com.devcdper.payment.domain.Payment">
			<result property="paymentCode"					column="payment_code"/>
			<result property="userEmail"					column="user_email"/>
			<result property="allPaymentConnectGroupCode"			column="all_payment_connect_group_code"/>
			<result property="allPaymentConnectTable"				column="all_payment_connect_table"/>
			<result property="paymentManagementContentsCode"					column="payment_management_contents_code"/>
			<result property="paymentOption"					column="payment_option"/>
			<result property="paymentStatus"	column="payment_status"/>
			<result property="paymentPrice"						column="payment_price"/>
			<result property="paymentDate"			column="payment_date"/>
		</association>
	</resultMap>
	
	<!-- 관리자 페이지 : 참여 챌린지 전체 행 조회 -->
	<select id="getChallengeParticipationCount" resultType="int">
			 SELECT 
				COUNT(1)

				FROM 
						challenge_participation AS cp
				INNER JOIN
						challenge AS c
				ON
						cp.challenge_code = c.challenge_code

				INNER JOIN
						user AS u
				ON
						cp.challenge_participation_email = u.user_email;
	</select>
	
	<!-- 관리자 페이지 : 챌린지 참여 전체 조회 -->
	<select id="getChallengeParticipationList" resultMap="ChallengeParticipationResultMap" parameterType="Map">
				   SELECT 
						c.challenge_name,
						cc.challenge_category_name,
						c.challenge_opener_email,
						u.user_email,
						c.challenge_scope,
						c.challenge_participation_password,
						c.challenge_maximum_people,
						c.challenge_bet_amount,
						c.challenge_certification_method,
						c.challenge_certification_contents,
						c.challenge_certification_frequency,
						c.challenge_start_date, 
						c.challenge_end_date, 
						c.challenge_register_date,
						cp.challenge_participation_date, 
						cp.challenge_service_start_date, 
						cp.challenge_service_end_date
				FROM 
						challenge_participation AS cp
				INNER JOIN
						challenge AS c
				ON
						cp.challenge_code = c.challenge_code
				INNER JOIN
						challenge_category AS cc
				ON
					c.challenge_category_code = cc.challenge_category_code
				INNER join
						user AS u
				ON
					cp.challenge_participation_email = u.user_email
					LIMIT #{rowStart}, #{rowPerPage};		
	</select>
	
	<!-- 나의 챌린지 : 테이블 행의 개수 조회 -->
	<select id="getMyChallengeCount"  resultType="int">
			   SELECT 
    		COUNT(1)
				FROM 
						challenge AS c		
				INNER JOIN
						challenge_category AS cc
				on
					c.challenge_category_code = cc.challenge_category_code
				INNER JOIN
						challenge_participation AS cp
				on
					c.challenge_code = cp.challenge_code
				WHERE
					cp.challenge_participation_email  = #{sessionEmail}                 
				OR	
				c.challenge_opener_email = #{sessionEmail}; 
	</select>

	<!-- 나의 챌린지 : 상세정보 조회 -->	
	<select id="getMyChallengeDetailInfoByChallengeCode" parameterType="String" resultMap="ChallengeParticipationResultMap">
	   SELECT 
	    				c.challenge_opener_email,
	    				cp.challenge_participation_email,
						c.challenge_code,
						c.challenge_name, 
						cc.challenge_category_name,
						c.challenge_tag,
						c.challenge_maximum_people,
						c.challenge_bet_amount,
						c.challenge_introduce,
						c.challenge_certification_contents,
						c.challenge_certification_frequency,
						c.challenge_start_date, 
						c.challenge_end_date
					FROM 
							challenge AS c		
					INNER JOIN
							challenge_category AS cc
					on
						c.challenge_category_code = cc.challenge_category_code
					INNER JOIN
							challenge_participation AS cp
					on
						c.challenge_code = cp.challenge_code
						and
						c.challenge_opener_email = #{sessionEmail}
						or
						cp.challenge_participation_email = #{sessionEmail}
					Where
						c.challenge_code=#{challengeCode}
					GROUP BY c.challenge_code	
		</select>
		
	<!-- 나의 챌린지 : 전체 리스트 조회 -->	
	<!-- 나의 챌린지 : 전체 리스트 조회 -->	
	<select id="getMyChallengeList" resultMap="ChallengeParticipationResultMap">
			   (SELECT 
						c.challenge_opener_email,
						cp.challenge_participation_email,
						c.challenge_code,
						c.challenge_name, 
						cc.challenge_category_name,
						c.challenge_tag,
						c.challenge_certification_frequency,
						c.challenge_start_date, 
						c.challenge_end_date
				FROM 
						challenge c 
				LEFT JOIN 
						challenge_category cc 
					ON 
					c.challenge_category_code = cc.challenge_category_code
				LEFT JOIN
										challenge_participation AS cp
								on
									c.challenge_code = cp.challenge_code
		
			WHERE c.challenge_code is not NULL
				AND
			cp.challenge_participation_email  = #{sessionEmail}
			OR
			c.challenge_opener_email = #{sessionEmail}
				GROUP BY c.challenge_code
				LIMIT #{rowStart}, #{rowPerPage})
				UNION 
				(SELECT 
						c.challenge_opener_email,
						cp.challenge_participation_email,
						c.challenge_code,
						c.challenge_name, 
						cc.challenge_category_name,
						c.challenge_tag,
						c.challenge_certification_frequency,
						c.challenge_start_date, 
						c.challenge_end_date
				FROM 
						challenge c 
				RIGHT JOIN 
						challenge_category cc 
				ON 
						c.challenge_category_code = cc.challenge_category_code
				LEFT JOIN
						challenge_participation AS cp
				on
						c.challenge_code = cp.challenge_code
		
			WHERE c.challenge_code is not NULL
			AND
			cp.challenge_participation_email  = #{sessionEmail}
			OR
			c.challenge_opener_email = #{sessionEmail}
			GROUP BY c.challenge_code
				LIMIT #{rowStart}, #{rowPerPage})
	</select>

	<!-- ChallengeCertification 관련 -->
	<resultMap type="com.devcdper.challenge.domain.ChallengeCertification" id="ChallengeCertificationResultMap">
		<result property="challengeCertificationCode"			column="challenge_certification_code"/>
		<result property="challengeCategoryCode"				column="challenge_category_code"/>
		<result property="challengeCode"						column="challenge_code"/>
		<result property="challengeParticipationCode"			column="challenge_participation_code"/>
		<result property="challengeParticipationEmail"			column="challenge_participation_email"/>
		<result property="challengeCertificationTitle"			column="challenge_certification_title"/>
		<result property="challengeCertificationMethod"			column="challenge_certification_method"/>
		<result property="challengeCertificationContents"		column="challenge_certification_contents"/>
		<result property="challengeCertificationAttachedFile"	column="challenge_certification_attached_file"/>
		<result property="challengeCertificationStatus"			column="challenge_certification_status"/>
		<result property="challengeCertificationDate"			column="challenge_certification_date"/>
		<association property="normalUser" 						javaType="com.devcdper.user_admin.domain.NormalUser">
			<result property="userEmail" 						column="user_email"/>
			<result property="userPassword" 					column="user_password"/>
			<result property="userName" 						column="user_name"/>
			<result property="userBirth" 						column="user_birth"/>
			<result property="userAddr" 						column="user_addr"/>
			<result property="userAddrDetail" 					column="user_addr_detail"/>
			<result property="userGender" 						column="user_gender"/>
			<result property="userMoblie" 						column="user_mobile"/>
			<result property="userJob" 		 					column="user_job"/>
			<result property="userIsReceiveMarketing" 			column="user_is_receive_marketing"/>
			<result property="userJoinMotivation" 				column="user_join_motivation"/>
			<result property="userJoinPath" 		 			column="user_join_path"/>
			<result property="userRecommendEmail" 				column="user_recommend_email"/>
			<result property="userJoinDate" 					column="user_join_date"/>
			<result property="userWithdrawStatus" 				column="user_withdraw_status"/>
		</association>
		<association property="challengeCategory" 				javaType="com.devcdper.challenge.domain.ChallengeCategory">
			<result property="challengeCategoryCode" 			column="challenge_category_code"></result>
			<result property="challengeCategoryName" 			column="challenge_category_name"></result>
		</association>
		<association property="challenge" javaType="com.devcdper.challenge.domain.Challenge">
			<result property="challengeCode"					column="challenge_code"/>
			<result property="challengeCategoryCode"			column="challenge_category_code"/>
			<result property="challengeOpenerEmail"				column="challenge_opener_email"/>
			<result property="challengeName"					column="challenge_name"/>
			<result property="challengeScope"					column="challenge_scope"/>
			<result property="challengeParticipationPassword"	column="challenge_participation_password"/>
			<result property="challengeTag"						column="challenge_tag"/>
			<result property="challengeMaximumPeople"			column="challenge_maximum_people"/>
			<result property="challengeBetAmount"				column="challenge_bet_amount"/>
			<result property="challengeCertificationMethod"		column="challenge_certification_method"/>
			<result property="challengeCertificationContents"	column="challenge_certification_contents"/>
			<result property="challengeCertificationFrequency"	column="challenge_certification_frequency"/>
			<result property="challengeProgressStatus"			column="challenge_progress_status"/>
			<result property="challengeStartDate"				column="challenge_start_date"/>
			<result property="challengeEndDate"					column="challenge_end_date"/>
			<result property="challengeRegisterDate"			column="challenge_register_date"/>
		</association>
		<association property="challengeParticipation" 			javaType="com.devcdper.challenge.domain.ChallengeParticipation">
			<result property="challengeParticipationCode"		column="challenge_participation_code"/>
			<result property="challengeCategoryCode"			column="challenge_category_code"/>
			<result property="challengeCode"					column="challenge_code"/>
			<result property="challengeParticipationEmail"		column="challenge_participation_email"/>
			<result property="challengeScope"					column="plan_detail_code"/>
			<result property="allPaymentConnectGroupCode"		column="all_payment_connect_group_code"/>
			<result property="challengeParticipationDate"		column="challenge_participation_date"/>
			<result property="challengeServiceStartDate"		column="challenge_service_start_date"/>
			<result property="challengeServiceEndDate"			column="challenge_service_end_date"/>
		</association>
	</resultMap>
	
	<!-- 챌린지 인증하기 : 인증가능한 챌린지 전체 리스트 조회  -->
	<select id="getChallengeCertificationInfo" parameterType="String" resultMap="ChallengeCertificationResultMap">
			SELECT
					c.challenge_code,	
					cc.challenge_category_code,
					cp.challenge_participation_code,
					cp.challenge_participation_email,
					c.challenge_name, 
					cc.challenge_category_name,
					c.challenge_certification_method
			FROM 
					challenge AS c
			INNER join
					challenge_category AS cc
			on
				c.challenge_category_code = cc.challenge_category_code
			INNER JOIN
					challenge_participation AS cp
			on
				c.challenge_code = cp.challenge_code	
			WHERE
				c.challenge_code = #{challengeCode}
			AND
				cp.challenge_participation_email = #{sessionEmail};
	</select>
	
	
	<!-- 챌린지 인증하기 : 챌린지 인증 등록 처리 -->
	<insert id="addChallengeCertification" parameterType="Map">
	INSERT INTO challenge_certification
			 (challenge_certification_code
			 , challenge_category_code
			 , challenge_code
			 , challenge_participation_code
			 , challenge_participation_email
			 , challenge_certification_title
			 , challenge_certification_method
			 , challenge_certification_contents
			 , challenge_certification_attached_file
			 , challenge_certification_status
			 , challenge_certification_date
 		)VALUES(
			 #{challengeCertificationCode}
			 , #{challengeCategoryCode}
			 , #{challengeCode}
			 , #{challengeParticipationCode}
		 	 , #{challengeParticipationEmail}
		 	 , #{challengeCertificationTitle}
			 , #{challengeCertificationMethod}
			 , #{challengeCertificationContents}
			 , #{challengeCertificationAttachedFile}
			 , #{challengeCertificationStatus}
			 , CURDATE());
	</insert>
	
	<!-- 챌린지 인증하기 : 인증가능한 챌린지 목록 조회 -->
	<select id="getVerifiableChallengeList" resultMap="ChallengeCertificationResultMap">
					SELECT 
						DISTINCT 
						c.challenge_code,
						cp.challenge_participation_email,
						c.challenge_name,
						cate.challenge_category_name,
						c.challenge_scope,
						c.challenge_tag,
						c.challenge_maximum_people,
						c.challenge_certification_method,
						c.challenge_start_date,
						c.challenge_end_date
					FROM 
						challenge_participation AS cp
					INNER JOIN
						challenge AS c
					ON
						cp.challenge_code = c.challenge_code
					INNER JOIN
						challenge_category AS cate
					ON
						c.challenge_category_code = cate.challenge_category_code
					INNER JOIN
						user AS u
					ON
						cp.challenge_participation_email = u.user_email
					WHERE
						cp.challenge_participation_email = #{sessionEmail};
	</select>
	
	
	<!-- 챌린지 인증게시판 : 챌린지 인증등록 후 게시판 전체 리스트 개수  -->
	<select id="getChallengeCertificationBoardCount" resultType="int">
					SELECT 
			    		COUNT(1)
					FROM 
						challenge_certification AS cc
					INNER JOIN
						challenge AS c
					ON
						cc.challenge_code = c.challenge_code
					INNER JOIN
						challenge_category AS cate
					ON
						cc.challenge_category_code = cate.challenge_category_code
					INNER JOIN
						challenge_participation AS cp
					on
						cc.challenge_participation_code = cp.challenge_participation_code
					INNER JOIN
						user AS u
					ON
						cc.challenge_participation_email = u.user_email
					WHERE
					cc.challenge_code  = #{challengeCode};
	</select>
	
	
	<!-- 챌린지 인증게시판 : 챌린지 인증등록 후 게시판 전체 리스트 조회 -->
	<select id="getChallengeCertificationBoardList" resultMap="ChallengeCertificationResultMap" parameterType="Map">
			SELECT 
				cc.challenge_certification_code, 
				cate.challenge_category_code, 
				c.challenge_code, 
				cp.challenge_participation_code, 
				cp.challenge_participation_email, 
				cc.challenge_certification_title, 
				cc.challenge_certification_method, 
				cc.challenge_certification_contents, 
				cc.challenge_certification_attached_file, 
				cc.challenge_certification_status, 
				cc.challenge_certification_date
			FROM 
				challenge_certification AS cc
					INNER JOIN
						challenge AS c
					ON
						cc.challenge_code = c.challenge_code
					INNER JOIN
						challenge_category cate
					ON
						cc.challenge_category_code = cate.challenge_category_code
					INNER JOIN
						challenge_participation AS cp
					on
						cc.challenge_participation_code = cp.challenge_participation_code
					INNER JOIN
						user AS u
					ON
						cc.challenge_participation_email = u.user_email
					WHERE
					cc.challenge_code  = #{challengeCode}
					LIMIT #{rowStart}, #{rowPerPage};
	</select>
	
	<!-- ChallengeCategory 관련 -->
	<resultMap type="com.devcdper.challenge.domain.ChallengeCategory" id="ChallengeCategoryResultMap">
		<result property="challengeCategoryCode" 	column="challenge_category_code"></result>
		<result property="challengeCategoryName" 	column="challenge_category_name"></result>
	</resultMap>
	
	<!-- 관리자 페이지 : 개설 챌린지 - 챌린지 카테고리 전체 조회 -->
	<select id="getChallengeCategoryList" resultMap="ChallengeCategoryResultMap">
			SELECT 
				challenge_category_code,
				challenge_category_name
			FROM 
				challenge_category
	</select>
	
	
	<!-- 관리자 페이지 : 개설 챌린지 - 카테고리 추가 -->
	<!-- <insert id="addChallengeCategory" parameterType="com.devcdper.challenge.domain.ChallengeCategory">
			INSERT INTO 
				challenge_category(
					   challenge_category_code
					 , challenge_category_name
				 )VALUES (
				 	  sf_newChallengeCategoryCode()
					, #{challengeCategoryName});
	</insert> -->
	
	<!-- 관리자 페이지 : 개설 챌린지 - 챌린지 카테고리 이름 수정 -->
	<update id="modifyChallengeCategoryName" parameterType="com.devcdper.challenge.domain.ChallengeCategory">
		UPDATE challenge_category
		<trim prefix="SET" prefixOverrides=",">
			<if test="challengeCategoryName != null and challengeCategoryName != ''.toString()">
				challenge_category_name=#{challengeCategoryName}
			</if>
		</trim>	
		WHERE 
				challenge_category_code=#{challengeCategoryCode};
	</update>
	
	<!-- ChallengeAchievementRate 관련 -->
	<resultMap type="com.devcdper.challenge.domain.ChallengeAchievementRate" id="ChallengeAchievementRateResultMap">
		<result property="challengeAchievementRateCode"				column="challenge_achievement_rate_code"/>
		<result property="challengeCategoryCode"					column="challenge_category_code"/>
		<result property="challengeCode"							column="challenge_code"/>
		<result property="challengeParticipationCode"				column="challenge_participation_code"/>
		<result property="challengeParticipationEmail"				column="challenge_participation_email"/>
		<result property="challengeAchievementRateSuccesCount"		column="challenge_achievement_rate_succes_count"/>
		<result property="challengeAchievementRateTotalTimes"		column="challenge_achievement_rate_total_times"/>
		<result property="challengeAchievementRate"					column="challenge_achievement_rate"/>
		<result property="challengeFinalRank"						column="challenge_final_rank"/>
		<result property="challengeAchievementRateUpdateDate"		column="challenge_achievement_rate_update_date"/>
		<association property="normalUser" 				javaType="com.devcdper.user_admin.domain.NormalUser">
			<result property="userEmail" 				column="user_email"/>
			<result property="userPassword" 			column="user_password"/>
			<result property="userName" 				column="user_name"/>
			<result property="userBirth" 				column="user_birth"/>
			<result property="userAddr" 				column="user_addr"/>
			<result property="userAddrDetail" 			column="user_addr_detail"/>
			<result property="userGender" 				column="user_gender"/>
			<result property="userMoblie" 				column="user_mobile"/>
			<result property="userJob" 		 			column="user_job"/>
			<result property="userIsReceiveMarketing" 	column="user_is_receive_marketing"/>
			<result property="userJoinMotivation" 		column="user_join_motivation"/>
			<result property="userJoinPath" 		 	column="user_join_path"/>
			<result property="userRecommendEmail" 		column="user_recommend_email"/>
			<result property="userJoinDate" 			column="user_join_date"/>
			<result property="userWithdrawStatus" 		column="user_withdraw_status"/>
		</association>
		<association property="challengeCategory" 		javaType="com.devcdper.challenge.domain.ChallengeCategory">
			<result property="challengeCategoryCode" 	column="challenge_category_code"></result>
			<result property="challengeCategoryName" 	column="challenge_category_name"></result>
		</association>
		<association property="challenge" javaType="com.devcdper.challenge.domain.Challenge">
			<result property="challengeCode"					column="challenge_code"/>
			<result property="challengeCategoryCode"			column="challenge_category_code"/>
			<result property="challengeOpenerEmail"				column="challenge_opener_email"/>
			<result property="challengeName"					column="challenge_name"/>
			<result property="challengeScope"					column="challenge_scope"/>
			<result property="challengeParticipationPassword"	column="challenge_participation_password"/>
			<result property="challengeTag"						column="challenge_tag"/>
			<result property="challengeMaximumPeople"			column="challenge_maximum_people"/>
			<result property="challengeBetAmount"				column="challenge_bet_amount"/>
			<result property="challengeCertificationMethod"		column="challenge_certification_method"/>
			<result property="challengeCertificationContents"	column="challenge_certification_contents"/>
			<result property="challengeCertificationFrequency"	column="challenge_certification_frequency"/>
			<result property="challengeProgressStatus"			column="challenge_progress_status"/>
			<result property="challengeStartDate"				column="challenge_start_date"/>
			<result property="challengeEndDate"					column="challenge_end_date"/>
			<result property="challengeRegisterDate"			column="challenge_register_date"/>
		</association>
		<association property="challengeParticipation" 		javaType="com.devcdper.challenge.domain.ChallengeParticipation">
			<result property="challengeParticipationCode"		column="challenge_participation_code"/>
			<result property="challengeCategoryCode"			column="challenge_category_code"/>
			<result property="challengeCode"					column="challenge_code"/>
			<result property="challengeParticipationEmail"		column="challenge_participation_email"/>
			<result property="challengeScope"					column="plan_detail_code"/>
			<result property="allPaymentConnectGroupCode"		column="all_payment_connect_group_code"/>
			<result property="challengeParticipationDate"		column="challenge_participation_date"/>
			<result property="challengeServiceStartDate"		column="challenge_service_start_date"/>
			<result property="challengeServiceEndDate"			column="challenge_service_end_date"/>
		</association>
	</resultMap>
	
	
	<!-- 관리자 페이지 : 챌린지 달성율 관리 - 챌린지 달성율 전체 리스트 조회 -->
	<select id="getChallengeAchievementRateList" resultMap="ChallengeAchievementRateResultMap">
			SELECT 
				c.challenge_name,
				u.user_email,
				cr.challenge_achievement_rate_succes_count,
				cr.challenge_achievement_rate_total_times,
				cr.challenge_achievement_rate,
				cr.challenge_final_rank,
				cr.challenge_achievement_rate_update_date
			FROM 
				challenge_achievement_rate AS cr
			INNER JOIN
				challenge AS c
			on
			cr.challenge_code = c.challenge_code
			INNER JOIN
				user AS u
			ON
			cr.challenge_participation_email = u.user_email
			LIMIT #{rowStart}, #{rowPerPage};
	</select>
	
	
	<!-- 관리자 페이지 : 챌린지 달성율 관리 - 챌린지 달성율 테이블 행의 개수 조회 -->
	<select id="getChallengeAchievementRateCount" resultType="int">
	SELECT 
		COUNT(1)
	FROM 
		challenge_achievement_rate
	</select>
	
	
	<!-- ChallengeCompensation 관련 -->
	<resultMap type="com.devcdper.challenge.domain.ChallengeCompensation" id="ChallengeCompensationResultMap">
			<result property="challengeCompensationCode" 			column="challenge_compensation_code"/>
			<result property="challengeCode" 						column="challenge_category_code"/>
			<result property="challengeCategoryCode" 				column="challenge_code"/>
			<result property="challengeParticipationCode" 			column="challenge_participation_code"/>
			<result property="challengeAchievementRateCode" 		column="challenge_achievement_rate_code"/>
			<result property="challengeParticipationEmail" 			column="challenge_participation_email"/>
			<result property="challengeRewardPrice" 				column="challenge_reward_price"/>
			<result property="challengeRewardBank" 		 			column="challenge_reward_bank"/>
			<result property="challengeRewardAccount" 				column="challenge_reward_account"/>
			<result property="challengeRewardDate" 					column="challenge_reward_date"/>
		<association property="normalUser" 				javaType="com.devcdper.user_admin.domain.NormalUser">
			<result property="userEmail" 				column="user_email"/>
			<result property="userPassword" 			column="user_password"/>
			<result property="userName" 				column="user_name"/>
			<result property="userBirth" 				column="user_birth"/>
			<result property="userAddr" 				column="user_addr"/>
			<result property="userAddrDetail" 			column="user_addr_detail"/>
			<result property="userGender" 				column="user_gender"/>
			<result property="userMoblie" 				column="user_mobile"/>
			<result property="userJob" 		 			column="user_job"/>
			<result property="userIsReceiveMarketing" 	column="user_is_receive_marketing"/>
			<result property="userJoinMotivation" 		column="user_join_motivation"/>
			<result property="userJoinPath" 		 	column="user_join_path"/>
			<result property="userRecommendEmail" 		column="user_recommend_email"/>
			<result property="userJoinDate" 			column="user_join_date"/>
			<result property="userWithdrawStatus" 		column="user_withdraw_status"/>
		</association>
		<association property="challengeCategory" 		javaType="com.devcdper.challenge.domain.ChallengeCategory">
			<result property="challengeCategoryCode" 	column="challenge_category_code"></result>
			<result property="challengeCategoryName" 	column="challenge_category_name"></result>
		</association>
		<association property="challenge" javaType="com.devcdper.challenge.domain.Challenge">
			<result property="challengeCode"					column="challenge_code"/>
			<result property="challengeCategoryCode"			column="challenge_category_code"/>
			<result property="challengeOpenerEmail"				column="challenge_opener_email"/>
			<result property="challengeName"					column="challenge_name"/>
			<result property="challengeScope"					column="challenge_scope"/>
			<result property="challengeParticipationPassword"	column="challenge_participation_password"/>
			<result property="challengeTag"						column="challenge_tag"/>
			<result property="challengeMaximumPeople"			column="challenge_maximum_people"/>
			<result property="challengeBetAmount"				column="challenge_bet_amount"/>
			<result property="challengeCertificationMethod"		column="challenge_certification_method"/>
			<result property="challengeCertificationContents"	column="challenge_certification_contents"/>
			<result property="challengeCertificationFrequency"	column="challenge_certification_frequency"/>
			<result property="challengeProgressStatus"			column="challenge_progress_status"/>
			<result property="challengeStartDate"				column="challenge_start_date"/>
			<result property="challengeEndDate"					column="challenge_end_date"/>
			<result property="challengeRegisterDate"			column="challenge_register_date"/>
		</association>
		<association property="challengeParticipation" 		javaType="com.devcdper.challenge.domain.ChallengeParticipation">
			<result property="challengeParticipationCode"			column="challenge_participation_code"/>
			<result property="challengeCategoryCode"			column="challenge_category_code"/>
			<result property="challengeCode"					column="challenge_code"/>
			<result property="challengeParticipationEmail"		column="challenge_participation_email"/>
			<result property="challengeScope"					column="plan_detail_code"/>
			<result property="allPaymentConnectGroupCode"		column="all_payment_connect_group_code"/>
			<result property="challengeParticipationDate"		column="challenge_participation_date"/>
			<result property="challengeServiceStartDate"		column="challenge_service_start_date"/>
			<result property="challengeServiceEndDate"			column="challenge_service_end_date"/>
		</association>
		<association property="challengeAchievementRate" javaType="com.devcdper.challenge.domain.ChallengeAchievementRate">
			<result property="challengeAchievementRateCode"			column="challenge_achievement_rate_code"/>
			<result property="challengeCategoryCode"				column="challenge_category_code"/>
			<result property="challengeCode"						column="challenge_code"/>
			<result property="challengeParticipationCode"			column="challenge_participation_code"/>
			<result property="challengeParticipationEmail"			column="challenge_participation_email"/>
			<result property="challengeAchievementRateSuccesCount"			column="challenge_achievement_rate_succes_count"/>
			<result property="challengeAchievementRateTotalTimes"			column="challenge_achievement_rate_total_times"/>
			<result property="challengeAchievementRateUpdateDate"		column="challenge_achievement_rate_update_date"/>
		</association>
	</resultMap>
	
	
	<!-- 관리자 페이지 : 챌린지 보상지급 관리 - 챌린지 보상지급 전체 리스트 조회 -->
	<select id="getChallengeCompensationList" resultMap="ChallengeCompensationResultMap" parameterType="Map">
			   SELECT 
				ccp.challenge_compensation_code, 
				cc.challenge_category_code, 
				c.challenge_name, 
				cp.challenge_participation_code,
				ccp.challenge_participation_email, 
				ccp.challenge_reward_price,
				ccp.challenge_reward_bank, 
				ccp.challenge_reward_account,
				ccp.challenge_reward_date
			FROM 
				challenge_compensation AS ccp
			INNER JOIN
				challenge AS c
			ON
				ccp.challenge_code = c.challenge_code
			INNER JOIN
				challenge_category AS cc
			ON
				ccp.challenge_category_code = cc.challenge_category_code
			INNER JOIN
				challenge_participation AS cp
			ON
				ccp.challenge_participation_code = cp.challenge_participation_code
			AND
				ccp.challenge_participation_email = cp.challenge_participation_email
	</select>
	
</mapper>